<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-name" content="winter-wonder">
  <title id="site-title">Accueil - Liberteko</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">
  <script src="/js/theme-loader.js"></script>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="header-container">
      <a href="/" class="logo">
        <i class="bi bi-snow2 logo-icon"></i>
        <span class="logo-text" id="header-title">LIBERTEKO</span>
      </a>
      <nav>
        <ul class="nav-menu">
          <li><a href="/" class="active">Accueil</a></li>
          <li><a href="/catalogue.html">Catalogue</a></li>
          <li><a href="/infos.html">Infos</a></li>
          <li><a href="/aide.html">Aide</a></li>
          <li id="nav-plan" style="display:none;"><a href="/plan.html">Plan</a></li>
          <li><a href="/contact.html">Contact</a></li>
        </ul>
      </nav>
      <a href="/usager/login.html" class="btn-login">
        <i class="bi bi-person-circle"></i> Connexion
      </a>
    </div>
  </header>

  <!-- Hero Section - Snow Globe -->
  <section class="hero">
    <div class="hero-content">
      <h1>Bienvenue dans notre <span class="highlight">bibliothèque</span></h1>
      <p>Découvrez notre collection de jeux, livres, films et disques à emprunter</p>

      <div class="search-container">
        <form class="frost-search" action="/catalogue.html" method="GET">
          <input type="text" name="q" placeholder="Rechercher un titre, un auteur..." autocomplete="off">
          <button type="submit">
            <i class="bi bi-search"></i>
          </button>
        </form>
      </div>

      <div class="hero-cta">
        <a href="/catalogue.html" class="btn btn-primary">
          <i class="bi bi-grid-3x3"></i> Explorer le catalogue
        </a>
        <a href="/infos.html" class="btn btn-secondary">
          <i class="bi bi-info-circle"></i> Nos horaires
        </a>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="stats-section">
    <div class="stats-grid">
      <div class="stat-box">
        <i class="bi bi-dice-6"></i>
        <span class="number" id="stat-jeux">0</span>
        <span class="label">Jeux</span>
      </div>
      <div class="stat-box">
        <i class="bi bi-book"></i>
        <span class="number" id="stat-livres">0</span>
        <span class="label">Livres</span>
      </div>
      <div class="stat-box">
        <i class="bi bi-film"></i>
        <span class="number" id="stat-films">0</span>
        <span class="label">Films</span>
      </div>
      <div class="stat-box">
        <i class="bi bi-vinyl"></i>
        <span class="number" id="stat-disques">0</span>
        <span class="label">Disques</span>
      </div>
    </div>
  </section>

  <!-- Collections Section -->
  <section class="collections-section">
    <h2 class="section-title">
      <i class="bi bi-collection icon"></i> Nos Collections
    </h2>

    <div class="collections-grid">
      <a href="/catalogue.html?collection=jeux" class="collection-card jeux">
        <div class="card-icon">
          <i class="bi bi-dice-6"></i>
        </div>
        <div class="card-content">
          <h3>Jeux de société</h3>
          <span class="count" id="count-jeux">Découvrir</span>
          <i class="bi bi-arrow-right arrow"></i>
        </div>
      </a>

      <a href="/catalogue.html?collection=livres" class="collection-card livres">
        <div class="card-icon">
          <i class="bi bi-book"></i>
        </div>
        <div class="card-content">
          <h3>Livres</h3>
          <span class="count" id="count-livres">Découvrir</span>
          <i class="bi bi-arrow-right arrow"></i>
        </div>
      </a>

      <a href="/catalogue.html?collection=films" class="collection-card films">
        <div class="card-icon">
          <i class="bi bi-film"></i>
        </div>
        <div class="card-content">
          <h3>Films</h3>
          <span class="count" id="count-films">Découvrir</span>
          <i class="bi bi-arrow-right arrow"></i>
        </div>
      </a>

      <a href="/catalogue.html?collection=disques" class="collection-card disques">
        <div class="card-icon">
          <i class="bi bi-vinyl"></i>
        </div>
        <div class="card-content">
          <h3>Disques</h3>
          <span class="count" id="count-disques">Découvrir</span>
          <i class="bi bi-arrow-right arrow"></i>
        </div>
      </a>
    </div>
  </section>

  <!-- Nouveautes Section -->
  <section class="collections-section" id="nouveautes-section" style="display: none;">
    <h2 class="section-title">
      <i class="bi bi-stars icon"></i> Nouveautés
    </h2>
    <div class="collections-grid" id="nouveautes-grid"></div>
  </section>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-section">
        <h4>Contact</h4>
        <p id="footer-address"></p>
        <p id="footer-phone"></p>
        <p id="footer-email"></p>
      </div>
      <div class="footer-section">
        <h4>Navigation</h4>
        <ul>
          <li><a href="/">Accueil</a></li>
          <li><a href="/catalogue.html">Catalogue</a></li>
          <li><a href="/infos.html">Infos pratiques</a></li>
          <li><a href="/contact.html">Contact</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Légal</h4>
        <ul>
          <li><a href="/mentions-legales.html">Mentions légales</a></li>
          <li><a href="/cgu.html">CGU</a></li>
          <li><a href="/cgv.html">CGV</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Espace membre</h4>
        <ul>
          <li><a href="/usager/login.html">Connexion</a></li>
          <li><a href="/admin/login.html">Administration</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; <span id="year"></span> <span id="footer-name">Liberteko</span> - Tous droits réservés</p>
    </div>
  </footer>

  <!-- Snowfall Animation -->
  <script src="/theme/js/snowfall.js"></script>

  <script>
    // Load configuration and stats
    async function init() {
      document.getElementById('year').textContent = new Date().getFullYear();

      try {
        // Load config
        const configResp = await fetch('/api/public/config');
        const config = await configResp.json();

        const siteName = config.nom_site || 'Liberteko';
        document.getElementById('site-title').textContent = `Accueil - ${siteName}`;
        document.getElementById('header-title').textContent = siteName.toUpperCase();
        document.getElementById('footer-name').textContent = siteName;

        // Contact info
        if (config.contact) {
          if (config.contact.adresse) {
            document.getElementById('footer-address').innerHTML = `<i class="bi bi-geo-alt"></i> ${config.contact.adresse}`;
          }
          if (config.contact.telephone) {
            document.getElementById('footer-phone').innerHTML = `<i class="bi bi-telephone"></i> ${config.contact.telephone}`;
          }
          if (config.contact.email) {
            document.getElementById('footer-email').innerHTML = `<i class="bi bi-envelope"></i> ${config.contact.email}`;
          }
        }

        // Load stats
        const statsResp = await fetch('/api/public/stats');
        const stats = await statsResp.json();

        if (stats.collections) {
          animateNumber('stat-jeux', stats.collections.jeux || 0);
          animateNumber('stat-livres', stats.collections.livres || 0);
          animateNumber('stat-films', stats.collections.films || 0);
          animateNumber('stat-disques', stats.collections.disques || 0);

          // Update collection counts
          if (stats.collections.jeux) {
            document.getElementById('count-jeux').textContent = `${stats.collections.jeux} jeux`;
          }
          if (stats.collections.livres) {
            document.getElementById('count-livres').textContent = `${stats.collections.livres} livres`;
          }
          if (stats.collections.films) {
            document.getElementById('count-films').textContent = `${stats.collections.films} films`;
          }
          if (stats.collections.disques) {
            document.getElementById('count-disques').textContent = `${stats.collections.disques} disques`;
          }
        }

        // Load nouveautes
        await loadNouveautes();

        // Check for Plan link visibility
        const parametresResp = await fetch('/api/public/parametres');
        const parametres = await parametresResp.json();
        if (parametres.module_plan_interactif) {
          const navPlan = document.getElementById('nav-plan');
          if (navPlan) navPlan.style.display = '';
        }

      } catch (e) {
        console.error('Init error:', e);
      }
    }

    // Animate number counting up
    function animateNumber(elementId, target) {
      const el = document.getElementById(elementId);
      const duration = 1000;
      const start = 0;
      const startTime = performance.now();

      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);
        const current = Math.floor(start + (target - start) * easeOut);

        el.textContent = current.toLocaleString('fr-FR');

        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }

      requestAnimationFrame(update);
    }

    // Load nouveautes
    async function loadNouveautes() {
      try {
        const resp = await fetch('/api/public/nouveautes?limit=8');
        const data = await resp.json();

        if (data.items && data.items.length > 0) {
          document.getElementById('nouveautes-section').style.display = 'block';

          const grid = document.getElementById('nouveautes-grid');
          grid.innerHTML = data.items.map(item => `
            <a href="/fiche.html?collection=${item.collection}&id=${item.id}" class="collection-card ${item.collection}">
              <div class="card-icon" style="height: 100px;">
                ${item.image_url
                  ? `<img src="${item.image_url}" alt="${item.nom || item.titre}" style="max-width: 80px; max-height: 80px; object-fit: contain; border-radius: 8px;">`
                  : `<i class="bi bi-${getIcon(item.collection)}"></i>`
                }
              </div>
              <div class="card-content">
                <h3 style="font-size: 0.95rem;">${item.nom || item.titre}</h3>
                <span class="count">${getTypeLabel(item.collection)}</span>
                <i class="bi bi-arrow-right arrow"></i>
              </div>
            </a>
          `).join('');
        }
      } catch (e) {
        console.error('Nouveautes error:', e);
      }
    }

    function getIcon(collection) {
      return { jeux: 'dice-6', livres: 'book', films: 'film', disques: 'vinyl' }[collection] || 'box';
    }

    function getTypeLabel(collection) {
      return { jeux: 'Jeu', livres: 'Livre', films: 'Film', disques: 'Disque' }[collection] || '';
    }

    init();
  </script>
  <script src="/js/animation-toggle.js"></script>
</body>
</html>
