<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="site-title">Assotheque</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/theme/css/theme.css">
</head>
<body>
  <!-- Decorative Pattern -->
  <div class="leaf-pattern"></div>

  <!-- Header - Organic Rounded -->
  <header class="site-header">
    <div class="header-container">
      <a href="/" class="logo">
        <i class="bi bi-tree"></i>
        <span id="header-title">Assotheque</span>
      </a>
      <nav>
        <ul class="nav-menu">
          <li><a href="/catalogue.html" class="active">Catalogue</a></li>
          <li><a href="/infos.html">Infos</a></li>
          <li><a href="/contact.html">Contact</a></li>
        </ul>
      </nav>
      <a href="/usager/login.html" class="btn-login">
        Mon Espace
      </a>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <h1 id="welcome-title">Cultivez votre curiosité</h1>
      <p id="welcome-subtitle">Découvrez notre jardin de ressources culturelles : jeux, livres, films et musique</p>

      <div class="search-wrapper">
        <form class="search-bar" action="/catalogue.html" method="get">
          <input type="text" name="q" placeholder="Que recherchez-vous aujourd'hui ?">
          <button type="submit">
            <i class="bi bi-search"></i> Explorer
          </button>
        </form>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Stats Pills -->
    <div class="stats-row">
      <div class="stat-pill">
        <i class="bi bi-collection"></i>
        <div>
          <div class="number" id="stat-total">0</div>
          <div class="label">Ressources</div>
        </div>
      </div>
      <div class="stat-pill">
        <i class="bi bi-check-circle"></i>
        <div>
          <div class="number" id="stat-disponibles">0</div>
          <div class="label">Disponibles</div>
        </div>
      </div>
      <div class="stat-pill">
        <i class="bi bi-people"></i>
        <div>
          <div class="number" id="stat-usagers">0</div>
          <div class="label">Usagers</div>
        </div>
      </div>
    </div>

    <!-- Collections Grid -->
    <h2 class="collections-title">Nos Collections</h2>

    <div class="collections-grid">
      <!-- Jeux -->
      <a href="/catalogue.html?collection=jeux" class="collection-card jeux">
        <div class="card-icon">
          <i class="bi bi-dice-6"></i>
        </div>
        <div class="card-content">
          <h3>Ludothèque</h3>
          <p class="count"><span id="count-jeux">0</span> jeux de société</p>
          <span class="explore-btn">
            <i class="bi bi-arrow-right-circle"></i> Explorer
          </span>
        </div>
      </a>

      <!-- Livres -->
      <a href="/catalogue.html?collection=livres" class="collection-card livres">
        <div class="card-icon">
          <i class="bi bi-book"></i>
        </div>
        <div class="card-content">
          <h3>Bibliothèque</h3>
          <p class="count"><span id="count-livres">0</span> ouvrages</p>
          <span class="explore-btn">
            <i class="bi bi-arrow-right-circle"></i> Explorer
          </span>
        </div>
      </a>

      <!-- Films -->
      <a href="/catalogue.html?collection=films" class="collection-card films">
        <div class="card-icon">
          <i class="bi bi-film"></i>
        </div>
        <div class="card-content">
          <h3>Filmothèque</h3>
          <p class="count"><span id="count-films">0</span> films</p>
          <span class="explore-btn">
            <i class="bi bi-arrow-right-circle"></i> Explorer
          </span>
        </div>
      </a>

      <!-- Disques -->
      <a href="/catalogue.html?collection=disques" class="collection-card disques">
        <div class="card-icon">
          <i class="bi bi-vinyl"></i>
        </div>
        <div class="card-content">
          <h3>Discothèque</h3>
          <p class="count"><span id="count-disques">0</span> albums</p>
          <span class="explore-btn">
            <i class="bi bi-arrow-right-circle"></i> Explorer
          </span>
        </div>
      </a>
    </div>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-section">
        <h4>Nous trouver</h4>
        <p id="footer-address"></p>
        <p id="footer-phone"></p>
        <p id="footer-email"></p>
      </div>
      <div class="footer-section">
        <h4>Horaires</h4>
        <div id="footer-horaires">
          <p>Voir la page Infos</p>
        </div>
      </div>
      <div class="footer-section">
        <h4>Liens</h4>
        <ul>
          <li><a href="/infos.html"><i class="bi bi-info-circle"></i> Présentation</a></li>
          <li><a href="/mentions-legales.html"><i class="bi bi-file-text"></i> Mentions légales</a></li>
          <li><a href="/cgu.html"><i class="bi bi-shield-check"></i> CGU</a></li>
          <li><a href="/contact.html"><i class="bi bi-envelope"></i> Contact</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; <span id="year"></span> <span id="footer-name">Assotheque</span> - Cultivons la culture ensemble</p>
    </div>
  </footer>

  <script>
    // Charger les paramètres
    async function loadConfig() {
      try {
        const resp = await fetch('/api/public/parametres');
        if (!resp.ok) return;
        const data = await resp.json();

        document.getElementById('site-title').textContent = data.nom || 'Assotheque';
        document.getElementById('header-title').textContent = data.nom || 'Assotheque';
        document.getElementById('footer-name').textContent = data.nom || 'Assotheque';

        if (data.adresse) {
          document.getElementById('footer-address').innerHTML = `<i class="bi bi-geo-alt"></i> ${data.adresse}`;
        }
        if (data.telephone) {
          document.getElementById('footer-phone').innerHTML = `<i class="bi bi-telephone"></i> ${data.telephone}`;
        }
        if (data.email) {
          document.getElementById('footer-email').innerHTML = `<i class="bi bi-envelope"></i> ${data.email}`;
        }
      } catch (e) {
        console.error('Erreur config:', e);
      }
    }

    // Charger les statistiques
    async function loadStats() {
      try {
        const resp = await fetch('/api/public/stats');
        if (!resp.ok) return;
        const data = await resp.json();

        const jeux = data.jeux || 0;
        const livres = data.livres || 0;
        const films = data.films || 0;
        const disques = data.disques || 0;
        const total = jeux + livres + films + disques;

        animateCounter('stat-total', total);
        animateCounter('stat-disponibles', data.disponibles || Math.floor(total * 0.85));
        animateCounter('stat-usagers', data.adherents || 0);

        document.getElementById('count-jeux').textContent = jeux.toLocaleString('fr-FR');
        document.getElementById('count-livres').textContent = livres.toLocaleString('fr-FR');
        document.getElementById('count-films').textContent = films.toLocaleString('fr-FR');
        document.getElementById('count-disques').textContent = disques.toLocaleString('fr-FR');
      } catch (e) {
        console.error('Erreur stats:', e);
      }
    }

    function animateCounter(elementId, target) {
      const el = document.getElementById(elementId);
      if (!el || target === 0) {
        if (el) el.textContent = '0';
        return;
      }

      let current = 0;
      const duration = 1200;
      const steps = 40;
      const increment = target / steps;
      const stepTime = duration / steps;

      const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
          current = target;
          clearInterval(timer);
        }
        el.textContent = Math.round(current).toLocaleString('fr-FR');
      }, stepTime);
    }

    document.getElementById('year').textContent = new Date().getFullYear();

    loadConfig();
    loadStats();
  </script>
</body>
</html>
