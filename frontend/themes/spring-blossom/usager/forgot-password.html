<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-name" content="spring-blossom">
  <title id="site-title">Mot de passe oublie - Liberteko</title>
  <link rel="stylesheet" href="/vendor/bootstrap-icons/bootstrap-icons.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">
  <script src="/js/theme-loader.js"></script>
  <style>
    .forgot-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: var(--space-xl); position: relative; z-index: 1; }
    .forgot-card { background: var(--spring-white); border-radius: var(--radius-xl); box-shadow: var(--card-shadow); width: 100%; max-width: 420px; overflow: hidden; border: var(--border-soft); animation: card-bloom 0.6s ease-out; }
    .forgot-header { background: var(--gradient-spring); padding: var(--space-xl); text-align: center; position: relative; overflow: hidden; }
    .forgot-header::before { content: ''; position: absolute; inset: 0; background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='20' cy='20' r='2' fill='rgba(255,255,255,0.3)'/%3E%3Ccircle cx='80' cy='30' r='3' fill='rgba(255,255,255,0.2)'/%3E%3Ccircle cx='40' cy='80' r='2' fill='rgba(255,255,255,0.3)'/%3E%3C/svg%3E"); animation: float-flowers 20s linear infinite; }
    .forgot-logo { width: 80px; height: 80px; background: var(--spring-white); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto var(--space-md); box-shadow: var(--bloom-glow); animation: bloom-pulse 3s ease-in-out infinite; position: relative; z-index: 1; }
    .forgot-logo i { font-size: 2.5rem; color: var(--spring-pink); }
    .forgot-header h1 { color: white; font-size: 1.5rem; margin: 0; text-shadow: 0 2px 10px rgba(0,0,0,0.1); position: relative; z-index: 1; }
    .forgot-header p { color: rgba(255,255,255,0.9); margin: var(--space-xs) 0 0; font-size: 0.95rem; position: relative; z-index: 1; }
    .forgot-body { padding: var(--space-xl); }
    .form-group { margin-bottom: var(--space-lg); }
    .form-label { display: block; font-weight: 600; color: var(--color-text); margin-bottom: var(--space-sm); font-size: 0.95rem; }
    .input-icon-wrapper { position: relative; }
    .input-icon-wrapper i { position: absolute; left: var(--space-md); top: 50%; transform: translateY(-50%); color: var(--spring-pink); font-size: 1.1rem; }
    .input-icon-wrapper input { padding-left: calc(var(--space-md) * 2 + 1.1rem); }
    .form-input { width: 100%; padding: var(--space-md); border: 2px solid #e5e7eb; border-radius: var(--radius-md); font-size: 1rem; transition: all 0.3s ease; background: var(--spring-white); }
    .form-input:focus { outline: none; border-color: var(--spring-pink); box-shadow: 0 0 0 4px rgba(236, 72, 153, 0.1); }
    .btn-submit { width: 100%; padding: var(--space-md) var(--space-lg); background: var(--gradient-spring); color: white; border: none; border-radius: var(--radius-md); font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: var(--space-sm); }
    .btn-submit:hover { transform: translateY(-2px); box-shadow: var(--hover-shadow); }
    .forgot-footer { text-align: center; padding: var(--space-lg); border-top: var(--border-light); background: var(--spring-cream); }
    .forgot-footer a { color: var(--spring-pink); font-weight: 600; display: flex; align-items: center; justify-content: center; gap: var(--space-xs); }
    .alert { padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-lg); display: none; align-items: center; gap: var(--space-sm); }
    .alert-danger { background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; }
    .alert-success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
    .alert.show { display: flex; }
    .info-box { background: var(--spring-pink-pale); padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-lg); display: flex; align-items: flex-start; gap: var(--space-sm); color: var(--color-text-secondary); font-size: 0.9rem; }
    .info-box i { color: var(--spring-pink); flex-shrink: 0; margin-top: 2px; }
    .success-content { text-align: center; padding: var(--space-lg) 0; }
    .success-content i { font-size: 4rem; color: var(--spring-green); margin-bottom: var(--space-md); display: block; animation: bloom-pulse 2s ease-in-out infinite; }
    .success-content h3 { color: var(--color-text); margin-bottom: var(--space-sm); }
    .success-content p { color: var(--color-text-secondary); }
    .flower-deco { position: absolute; font-size: 2rem; opacity: 0.1; animation: float-flower 6s ease-in-out infinite; }
    .flower-deco:nth-child(1) { top: 10%; left: 5%; animation-delay: 0s; }
    .flower-deco:nth-child(2) { top: 30%; right: 8%; animation-delay: 1.5s; }
    .flower-deco:nth-child(3) { bottom: 20%; left: 10%; animation-delay: 0.8s; }
    .flower-deco:nth-child(4) { bottom: 10%; right: 5%; animation-delay: 2s; }
    @keyframes float-flower { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-15px) rotate(10deg); } }
    @media (max-width: 480px) { .forgot-card { margin: var(--space-md); } .forgot-header, .forgot-body { padding: var(--space-lg); } }
  </style>
</head>
<body>
  <div class="petals-container">
    <div class="petal"></div><div class="petal"></div><div class="petal"></div><div class="petal"></div><div class="petal"></div>
    <div class="petal"></div><div class="petal"></div><div class="petal"></div><div class="petal"></div><div class="petal"></div>
  </div>

  <span class="flower-deco">ðŸŒ¸</span>
  <span class="flower-deco">ðŸŒ·</span>
  <span class="flower-deco">ðŸŒº</span>
  <span class="flower-deco">ðŸ’®</span>

  <div class="forgot-page">
    <div class="forgot-card">
      <div class="forgot-header">
        <div class="forgot-logo"><i class="bi bi-key"></i></div>
        <h1>Mot de passe oublie</h1>
        <p>Recuperez l'acces a votre compte</p>
      </div>

      <div class="forgot-body">
        <div class="alert alert-danger" id="error-alert"><i class="bi bi-exclamation-circle"></i><span id="error-message"></span></div>

        <div id="form-section">
          <div class="info-box">
            <i class="bi bi-info-circle"></i>
            <span>Entrez votre adresse email. Si un compte existe, vous recevrez un lien pour reinitialiser votre mot de passe.</span>
          </div>

          <form id="forgot-form">
            <div class="form-group">
              <label class="form-label" for="email">Adresse email</label>
              <div class="input-icon-wrapper">
                <i class="bi bi-envelope"></i>
                <input type="email" id="email" class="form-input" placeholder="votre@email.com" required>
              </div>
            </div>

            <button type="submit" class="btn-submit">
              <i class="bi bi-send"></i>
              Envoyer le lien
            </button>
          </form>
        </div>

        <div id="success-section" style="display: none;">
          <div class="success-content">
            <i class="bi bi-envelope-check"></i>
            <h3>Email envoye !</h3>
            <p>Si un compte existe avec cette adresse, vous recevrez un email avec les instructions pour reinitialiser votre mot de passe.</p>
          </div>
        </div>
      </div>

      <div class="forgot-footer">
        <a href="/usager/login.html"><i class="bi bi-arrow-left"></i> Retour a la connexion</a>
      </div>
    </div>
  </div>

  <script>
    async function init() {
      try {
        const configResp = await fetch('/api/public/config');
        const config = await configResp.json();
        const siteName = config.nom_site || 'Liberteko';
        document.getElementById('site-title').textContent = `Mot de passe oublie - ${siteName}`;
      } catch (e) { console.error('Config error:', e); }
    }

    document.getElementById('forgot-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      hideError();

      const email = document.getElementById('email').value;

      try {
        const resp = await fetch('/api/usager/auth/forgot-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });

        // Always show success to prevent email enumeration
        document.getElementById('form-section').style.display = 'none';
        document.getElementById('success-section').style.display = 'block';
      } catch (e) {
        console.error('Forgot password error:', e);
        showError('Erreur de connexion. Veuillez reessayer.');
      }
    });

    function showError(message) {
      document.getElementById('error-message').textContent = message;
      document.getElementById('error-alert').classList.add('show');
    }

    function hideError() {
      document.getElementById('error-alert').classList.remove('show');
    }

    init();
  </script>
  <script src="/js/animation-toggle.js"></script>
</body>
</html>
