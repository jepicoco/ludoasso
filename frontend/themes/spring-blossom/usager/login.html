<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-name" content="spring-blossom">
  <title id="site-title">Connexion - Liberteko</title>
  <link rel="stylesheet" href="/vendor/bootstrap-icons/bootstrap-icons.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">
  <script src="/js/theme-loader.js"></script>
  <style>
    .login-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: var(--space-xl); position: relative; z-index: 1; }
    .login-card { background: var(--spring-white); border-radius: var(--radius-xl); box-shadow: var(--card-shadow); width: 100%; max-width: 420px; overflow: hidden; border: var(--border-soft); animation: card-bloom 0.6s ease-out; }
    .login-header { background: var(--gradient-spring); padding: var(--space-xl); text-align: center; position: relative; overflow: hidden; }
    .login-header::before { content: ''; position: absolute; inset: 0; background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='20' cy='20' r='2' fill='rgba(255,255,255,0.3)'/%3E%3Ccircle cx='80' cy='30' r='3' fill='rgba(255,255,255,0.2)'/%3E%3Ccircle cx='40' cy='80' r='2' fill='rgba(255,255,255,0.3)'/%3E%3Ccircle cx='90' cy='70' r='2' fill='rgba(255,255,255,0.2)'/%3E%3C/svg%3E"); animation: float-flowers 20s linear infinite; }
    .login-logo { width: 80px; height: 80px; background: var(--spring-white); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto var(--space-md); box-shadow: var(--bloom-glow); animation: bloom-pulse 3s ease-in-out infinite; position: relative; z-index: 1; }
    .login-logo i { font-size: 2.5rem; color: var(--spring-pink); }
    .login-header h1 { color: white; font-size: 1.5rem; margin: 0; text-shadow: 0 2px 10px rgba(0,0,0,0.1); position: relative; z-index: 1; }
    .login-header p { color: rgba(255,255,255,0.9); margin: var(--space-xs) 0 0; font-size: 0.95rem; position: relative; z-index: 1; }
    .login-body { padding: var(--space-xl); }
    .form-group { margin-bottom: var(--space-lg); }
    .form-label { display: block; font-weight: 600; color: var(--color-text); margin-bottom: var(--space-sm); font-size: 0.95rem; }
    .input-icon-wrapper { position: relative; }
    .input-icon-wrapper i { position: absolute; left: var(--space-md); top: 50%; transform: translateY(-50%); color: var(--spring-pink); font-size: 1.1rem; }
    .input-icon-wrapper input { padding-left: calc(var(--space-md) * 2 + 1.1rem); }
    .form-input { width: 100%; padding: var(--space-md); border: 2px solid #e5e7eb; border-radius: var(--radius-md); font-size: 1rem; transition: all 0.3s ease; background: var(--spring-white); }
    .form-input:focus { outline: none; border-color: var(--spring-pink); box-shadow: 0 0 0 4px rgba(236, 72, 153, 0.1); }
    .form-options { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg); flex-wrap: wrap; gap: var(--space-sm); }
    .remember-me { display: flex; align-items: center; gap: var(--space-xs); cursor: pointer; }
    .remember-me input { width: 18px; height: 18px; accent-color: var(--spring-pink); cursor: pointer; }
    .forgot-link { color: var(--spring-pink); font-size: 0.9rem; transition: color 0.3s ease; }
    .forgot-link:hover { color: var(--spring-rose); text-decoration: underline; }
    .btn-login-submit { width: 100%; padding: var(--space-md) var(--space-lg); background: var(--gradient-spring); color: white; border: none; border-radius: var(--radius-md); font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: var(--space-sm); }
    .btn-login-submit:hover { transform: translateY(-2px); box-shadow: var(--hover-shadow); }
    .btn-login-submit:active { transform: translateY(0); }
    .login-footer { text-align: center; padding: var(--space-lg); border-top: var(--border-light); background: var(--spring-cream); }
    .login-footer a { color: var(--spring-pink); font-weight: 600; }
    .alert { padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-lg); display: none; align-items: center; gap: var(--space-sm); }
    .alert-danger { background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; }
    .alert-success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
    .alert.show { display: flex; }
    .flower-deco { position: absolute; font-size: 2rem; opacity: 0.1; animation: float-flower 6s ease-in-out infinite; }
    .flower-deco:nth-child(1) { top: 10%; left: 5%; animation-delay: 0s; }
    .flower-deco:nth-child(2) { top: 30%; right: 8%; animation-delay: 1.5s; }
    .flower-deco:nth-child(3) { bottom: 20%; left: 10%; animation-delay: 0.8s; }
    .flower-deco:nth-child(4) { bottom: 10%; right: 5%; animation-delay: 2s; }
    @keyframes float-flower { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-15px) rotate(10deg); } }
    @media (max-width: 480px) { .login-card { margin: var(--space-md); } .login-header, .login-body { padding: var(--space-lg); } .form-options { flex-direction: column; align-items: flex-start; } }
  </style>
</head>
<body>
  <div class="petals-container">
    <div class="petal"></div><div class="petal"></div><div class="petal"></div><div class="petal"></div><div class="petal"></div>
    <div class="petal"></div><div class="petal"></div><div class="petal"></div><div class="petal"></div><div class="petal"></div>
  </div>

  <span class="flower-deco">üå∏</span>
  <span class="flower-deco">üå∑</span>
  <span class="flower-deco">üå∫</span>
  <span class="flower-deco">üíÆ</span>

  <div class="login-page">
    <div class="login-card">
      <div class="login-header">
        <div class="login-logo"><i class="bi bi-flower1"></i></div>
        <h1 id="login-title">Espace membre</h1>
        <p>Connectez-vous pour acceder a vos services</p>
      </div>

      <div class="login-body">
        <div class="alert alert-danger" id="error-alert"><i class="bi bi-exclamation-circle"></i><span id="error-message"></span></div>
        <div class="alert alert-success" id="success-alert"><i class="bi bi-check-circle"></i><span id="success-message"></span></div>

        <form id="login-form">
          <div class="form-group">
            <label class="form-label" for="email">Adresse email</label>
            <div class="input-icon-wrapper">
              <i class="bi bi-envelope"></i>
              <input type="email" id="email" class="form-input" placeholder="votre@email.com" required>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="password">Mot de passe</label>
            <div class="input-icon-wrapper">
              <i class="bi bi-lock"></i>
              <input type="password" id="password" class="form-input" placeholder="Votre mot de passe" required>
            </div>
          </div>

          <div class="form-options">
            <label class="remember-me">
              <input type="checkbox" id="remember">
              <span>Se souvenir de moi</span>
            </label>
            <a href="/usager/forgot-password.html" class="forgot-link">Mot de passe oublie ?</a>
          </div>

          <button type="submit" class="btn-login-submit">
            <i class="bi bi-box-arrow-in-right"></i>
            Se connecter
          </button>
        </form>
      </div>

      <div class="login-footer">
        <a href="/">‚Üê Retour a l'accueil</a>
      </div>
    </div>
  </div>

  <script>
    async function init() {
      try {
        const configResp = await fetch('/api/public/config');
        const config = await configResp.json();
        const siteName = config.nom_site || 'Liberteko';
        document.getElementById('site-title').textContent = `Connexion - ${siteName}`;
        document.getElementById('login-title').textContent = siteName;
      } catch (e) { console.error('Config error:', e); }

      const params = new URLSearchParams(window.location.search);
      if (params.get('reset') === 'success') showSuccess('Mot de passe reinitialise avec succes. Vous pouvez vous connecter.');
      if (params.get('registered') === 'true') showSuccess('Inscription reussie. Vous pouvez vous connecter.');

      if (localStorage.getItem('usager_token')) window.location.href = '/usager/dashboard.html';
    }

    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      hideAlerts();

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      try {
        const resp = await fetch('/api/usager/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await resp.json();

        if (!resp.ok) {
          showError(data.message || 'Identifiants incorrects');
          return;
        }

        localStorage.setItem('usager_token', data.token);
        localStorage.setItem('usager_info', JSON.stringify(data.user));
        window.location.href = '/usager/dashboard.html';
      } catch (e) {
        console.error('Login error:', e);
        showError('Erreur de connexion. Veuillez reessayer.');
      }
    });

    function showError(message) { document.getElementById('error-message').textContent = message; document.getElementById('error-alert').classList.add('show'); }
    function showSuccess(message) { document.getElementById('success-message').textContent = message; document.getElementById('success-alert').classList.add('show'); }
    function hideAlerts() { document.getElementById('error-alert').classList.remove('show'); document.getElementById('success-alert').classList.remove('show'); }

    init();
  </script>
  <script src="/js/animation-toggle.js"></script>
</body>
</html>
