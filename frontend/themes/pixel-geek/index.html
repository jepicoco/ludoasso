<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="site-title">Assotheque</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="/theme/css/theme.css">
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="header-container">
      <a href="/" class="logo">
        <i class="bi bi-controller"></i>
        <span id="header-title">ASSOTHEQUE</span>
      </a>
      <nav>
        <ul class="nav-menu">
          <li><a href="/catalogue.html">CATALOGUE</a></li>
          <li><a href="/infos.html">INFOS</a></li>
          <li><a href="/contact.html">CONTACT</a></li>
        </ul>
      </nav>
      <a href="/usager/login.html" class="btn-login">LOGIN</a>
    </div>
  </header>

  <!-- Hero Section - Title Screen -->
  <section class="hero">
    <div class="hero-content">
      <h1 id="welcome-title">BIENVENUE PLAYER 1</h1>
      <p>Explorez notre collection de jeux, livres, films et disques</p>

      <div class="search-container">
        <form class="pixel-search" action="/catalogue.html" method="get">
          <input type="text" name="q" placeholder="RECHERCHER...">
          <button type="submit">GO!</button>
        </form>
      </div>

      <p class="press-start">APPUYEZ SUR ENTREE POUR COMMENCER</p>
    </div>
  </section>

  <!-- Stats Section - Score Display -->
  <section class="stats-section">
    <div class="stats-grid">
      <div class="stat-box">
        <i class="bi bi-dice-6"></i>
        <div class="number" id="stat-jeux">000</div>
        <div class="label">JEUX</div>
      </div>
      <div class="stat-box">
        <i class="bi bi-book"></i>
        <div class="number" id="stat-livres">000</div>
        <div class="label">LIVRES</div>
      </div>
      <div class="stat-box">
        <i class="bi bi-film"></i>
        <div class="number" id="stat-films">000</div>
        <div class="label">FILMS</div>
      </div>
      <div class="stat-box">
        <i class="bi bi-vinyl"></i>
        <div class="number" id="stat-disques">000</div>
        <div class="label">DISQUES</div>
      </div>
    </div>
  </section>

  <!-- Collections - Level Select -->
  <section class="collections-section">
    <h2 class="section-title">[ SELECT LEVEL ]</h2>

    <div class="collections-grid">
      <!-- Jeux -->
      <a href="/catalogue.html?collection=jeux" class="collection-card jeux">
        <div class="card-icon">
          <i class="bi bi-dice-6"></i>
        </div>
        <div class="card-content">
          <h3>LUDOTHEQUE</h3>
          <p class="count">
            <span id="count-jeux">0</span> items
            <span class="pixel-arrow">&gt;&gt;</span>
          </p>
        </div>
      </a>

      <!-- Livres -->
      <a href="/catalogue.html?collection=livres" class="collection-card livres">
        <div class="card-icon">
          <i class="bi bi-book"></i>
        </div>
        <div class="card-content">
          <h3>BIBLIOTHEQUE</h3>
          <p class="count">
            <span id="count-livres">0</span> items
            <span class="pixel-arrow">&gt;&gt;</span>
          </p>
        </div>
      </a>

      <!-- Films -->
      <a href="/catalogue.html?collection=films" class="collection-card films">
        <div class="card-icon">
          <i class="bi bi-film"></i>
        </div>
        <div class="card-content">
          <h3>FILMOTHEQUE</h3>
          <p class="count">
            <span id="count-films">0</span> items
            <span class="pixel-arrow">&gt;&gt;</span>
          </p>
        </div>
      </a>

      <!-- Disques -->
      <a href="/catalogue.html?collection=disques" class="collection-card disques">
        <div class="card-icon">
          <i class="bi bi-vinyl"></i>
        </div>
        <div class="card-content">
          <h3>DISCOTHEQUE</h3>
          <p class="count">
            <span id="count-disques">0</span> items
            <span class="pixel-arrow">&gt;&gt;</span>
          </p>
        </div>
      </a>
    </div>
  </section>

  <!-- Footer - Credits -->
  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-section">
        <h4>CONTACT</h4>
        <p id="footer-address"></p>
        <p id="footer-phone"></p>
        <p id="footer-email"></p>
      </div>
      <div class="footer-section">
        <h4>HORAIRES</h4>
        <div id="footer-horaires">
          <p>CHECK PAGE INFOS</p>
        </div>
      </div>
      <div class="footer-section">
        <h4>LINKS</h4>
        <ul>
          <li><a href="/mentions-legales.html">MENTIONS LEGALES</a></li>
          <li><a href="/cgu.html">CGU</a></li>
          <li><a href="/contact.html">CONTACT</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>[ <span id="year"></span> ] <span id="footer-name">ASSOTHEQUE</span> - POWERED BY PIXEL MAGIC</p>
    </div>
  </footer>

  <script>
    // Format number with leading zeros (like old games)
    function formatScore(num, digits = 3) {
      return num.toString().padStart(digits, '0');
    }

    // Animate counter like arcade score
    function animateScore(elementId, target) {
      const el = document.getElementById(elementId);
      if (!el) return;

      let current = 0;
      const digits = Math.max(3, target.toString().length);
      const increment = Math.ceil(target / 30);
      const interval = setInterval(() => {
        current += increment;
        if (current >= target) {
          current = target;
          clearInterval(interval);
        }
        el.textContent = formatScore(current, digits);
      }, 50);
    }

    // Load config
    async function loadConfig() {
      try {
        const resp = await fetch('/api/public/parametres');
        if (!resp.ok) return;
        const data = await resp.json();

        const nom = (data.nom || 'ASSOTHEQUE').toUpperCase();
        document.getElementById('site-title').textContent = nom;
        document.getElementById('header-title').textContent = nom;
        document.getElementById('footer-name').textContent = nom;

        if (data.adresse) {
          document.getElementById('footer-address').textContent = data.adresse.toUpperCase();
        }
        if (data.telephone) {
          document.getElementById('footer-phone').textContent = data.telephone;
        }
        if (data.email) {
          document.getElementById('footer-email').textContent = data.email.toUpperCase();
        }
      } catch (e) {
        console.error('Config error:', e);
      }
    }

    // Load stats
    async function loadStats() {
      try {
        const resp = await fetch('/api/public/stats');
        if (!resp.ok) return;
        const data = await resp.json();

        // Animate scores
        setTimeout(() => animateScore('stat-jeux', data.jeux || 0), 100);
        setTimeout(() => animateScore('stat-livres', data.livres || 0), 200);
        setTimeout(() => animateScore('stat-films', data.films || 0), 300);
        setTimeout(() => animateScore('stat-disques', data.disques || 0), 400);

        document.getElementById('count-jeux').textContent = data.jeux || 0;
        document.getElementById('count-livres').textContent = data.livres || 0;
        document.getElementById('count-films').textContent = data.films || 0;
        document.getElementById('count-disques').textContent = data.disques || 0;
      } catch (e) {
        console.error('Stats error:', e);
      }
    }

    // Keyboard navigation (like a game!)
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        document.querySelector('.pixel-search input').focus();
      }
    });

    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Init
    loadConfig();
    loadStats();
  </script>
</body>
</html>
